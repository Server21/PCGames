<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bonazza Games</title>
  <!-- Collega il file CSS unificato -->
  <link rel="stylesheet" href="Bra.css">
  <style>
    /* Se vuoi aggiungere stili specifici per questa pagina, inseriscili qui */
  </style>
</head>
<body>
  <header>
    <div class="account-info" id="account-info">
      <!-- Qui puoi inserire informazioni utente se necessario -->
      <h1>Benvenuto su Bonazza Games</h1>
    </div>
    <div id="online-status">
      <span class="online-dot"></span>
      <span id="online-count">0</span> utenti online
      <!-- Pulsante di logout, se necessario -->
      <a href="login.html" class="logout-btn">Logout</a>
    </div>
  </header>
  
  <main class="container">
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Cerca giochi per nome, descrizione, lingua...">
    </div>
    <div class="tag-filter">
      <label for="tag-filter-select">Filtra per tag:</label>
      <select id="tag-filter-select">
        <option value="">Tutti</option>
        <!-- Opzioni per i tag saranno aggiunte dinamicamente -->
      </select>
    </div>
    <div class="games-grid" id="games-grid">
      <!-- Qui verranno visualizzati i giochi -->
    </div>
  </main>

  <script>
    // Funzione debounce per ottimizzare la ricerca
    function debounce(func, delay) {
      let timer;
      return function(...args) {
        clearTimeout(timer);
        timer = setTimeout(() => func.apply(this, args), delay);
      };
    }

    // Funzione per visualizzare i giochi
    function displayGames(games) {
      const grid = document.getElementById("games-grid");
      grid.innerHTML = "";
      games.forEach(game => {
        // Creazione della scheda gioco
        const card = document.createElement("div");
        card.className = "game-card";
        card.innerHTML = `
          <img src="${game.image_url}" alt="${game.name}">
          <div class="content">
            <h3>${game.name}</h3>
            <p>${game.description}</p>
            <p><strong>Categorie:</strong> ${game.category.join(", ")}</p>
            <p><strong>Lingue supportate:</strong> ${game.languages.join(", ")}</p>
            <button class="download-btn" onclick="window.location.href='${game.download_link}'">Scarica</button>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // Funzione per popolare il filtro dei tag
    function populateTagFilter(games) {
      const tagSelect = document.getElementById("tag-filter-select");
      const tagsSet = new Set();
      games.forEach(game => {
        if (Array.isArray(game.category)) {
          game.category.forEach(tag => tagsSet.add(tag));
        }
      });
      const tags = Array.from(tagsSet).sort();
      tags.forEach(tag => {
        const option = document.createElement("option");
        option.value = tag;
        option.textContent = tag;
        tagSelect.appendChild(option);
      });
    }

    // Funzione per applicare filtri (ricerca e tag)
    function applyFilters(games) {
      const query = document.getElementById("search-input").value.trim().toLowerCase();
      const selectedTag = document.getElementById("tag-filter-select").value;
      return games.filter(game => {
        let matchesSearch = true;
        if (query) {
          matchesSearch = (game.name && game.name.toLowerCase().includes(query)) ||
                          (game.description && game.description.toLowerCase().includes(query)) ||
                          (game.languages && game.languages.some(lang => lang.toLowerCase().includes(query)));
        }
        let matchesTag = true;
        if (selectedTag) {
          matchesTag = game.category && game.category.includes(selectedTag);
        }
        return matchesSearch && matchesTag;
      });
    }

    // Funzione per caricare i giochi usando un proxy CORS (AllOrigins)
    async function loadGames() {
      try {
        const proxyUrl = "https://api.allorigins.hexocode.repl.co/get?disableCache=true&url=";
        const targetUrl = "https://raw.githubusercontent.com/Server21/PCGames/refs/heads/main/games.json";
        const response = await fetch(proxyUrl + encodeURIComponent(targetUrl));
        if (!response.ok) throw new Error("Errore nel caricamento dei giochi");
        const data = await response.json();
        const games = JSON.parse(data.contents);
        // Mostra i giochi e popola il filtro dei tag
        displayGames(games);
        populateTagFilter(games);
        
        // Aggiunge gli event listener per la ricerca e il filtro
        const runFilters = debounce(() => {
          const filtered = applyFilters(games);
          displayGames(filtered);
        }, 300);
        document.getElementById("search-input").addEventListener("input", runFilters);
        document.getElementById("tag-filter-select").addEventListener("change", runFilters);
      } catch (error) {
        console.error("Errore nel caricamento dei giochi:", error);
        document.getElementById("games-grid").innerText = "Errore nel caricamento dei giochi.";
      }
    }

    // Inizializza il caricamento dei giochi quando il DOM Ã¨ pronto
    document.addEventListener("DOMContentLoaded", loadGames);
  </script>
</body>
</html>
